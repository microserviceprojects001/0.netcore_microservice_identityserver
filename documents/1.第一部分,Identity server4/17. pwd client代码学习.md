# 理解

projects\IdentityServerSample\PwdClient\Program.cs

在获取用户基本信息的时候

```
 var userInfoResponse = await httpClient.GetUserInfoAsync(new UserInfoRequest
    {
        Address = disco.UserInfoEndpoint,
        Token = passwordTokenResponse.AccessToken
    });
```

如果需要得到用户的 基本信息，需要scope加上 profile
需要得到用户的email，那scope上需要加 email

## 如果你确实需要使用自定义声明（比如 givenName），你需要：

方法 A：扩展 Profile 资源

```
public static IEnumerable<IdentityResource> GetIdentityResources()
{
    return new List<IdentityResource>
    {
        new IdentityResources.OpenId(),

        // 自定义 Profile 资源，包含标准声明和自定义声明
        new IdentityResource(
            name: "profile",
            displayName: "User profile",
            userClaims: new[]
            {
                "name",
                "family_name",
                "given_name",
                "middle_name",
                "nickname",
                "preferred_username",
                "profile",
                "picture",
                "website",
                "gender",
                "birthdate",
                "zoneinfo",
                "locale",
                "updated_at",
                "givenName"  // 添加自定义声明
            })
        {
            Description = "Your user profile information"
        },

        new IdentityResource(
            name: "email",
            displayName: "Your email address",
            userClaims: new[] { "email", "email_verified" })
    };
}
```

方法 B：创建自定义身份资源

```
public static IEnumerable<IdentityResource> GetIdentityResources()
{
    return new List<IdentityResource>
    {
        new IdentityResources.OpenId(),
        new IdentityResources.Profile(),
        new IdentityResources.Email(),

        // 创建自定义身份资源
        new IdentityResource(
            name: "custom",
            displayName: "Custom user information",
            userClaims: new[]
            {
                "givenName",  // 你的自定义声明
                "customField1",
                "customField2"
            })
        {
            Description = "Custom user information"
        }
    };
}
```

然后在客户端配置中添加这个自定义 scope：

```
AllowedScopes = {
    "api",
    "openid",
    "profile",
    "email",
    "custom"  // 添加自定义 scope
}
```

在客户端请求时也包含这个 scope：

```
Scope = "openid api profile email custom"
```
